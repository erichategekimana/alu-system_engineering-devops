#!/usr/bin/env bash
# 4-not_found_page_404: Configure custom 404 error page

# Create 404 page if it doesn't exist
if [ ! -f /var/www/html/404.html ]; then
    echo "Ceci n'est pas une page" | sudo tee /var/www/html/404.html > /dev/null
fi

# Configure Nginx
NGINX_CONFIG="/etc/nginx/sites-available/default"

# Add error_page directive if not present
if ! grep -q "error_page 404 /404.html;" "$NGINX_CONFIG"; then
    sudo awk '/server_name[[:space:]]+_;/ && !done {
        print
        print "    error_page 404 /404.html;"
        print "    location = /404.html {"
        print "        internal;"
        print "    }"
        done=1
        next
    }1' "$NGINX_CONFIG" > /tmp/nginx.tmp && sudo mv /tmp/nginx.tmp "$NGINX_CONFIG"
fi

# Test and reload
sudo nginx -t && sudo systemctl reload nginx
echo "Ceci n'est pas une page"
